<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>CoAP Signaling Messages</title>

  <style type="text/css">/*<![CDATA[*/
@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}

@media screen and (min-width: 1024px) {
  ul.toc, #rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    padding: 0 1em;
    z-index: 1;
  }
  #rfc\.toc {
    top: 16px;
  }
  ul.toc {
    top: 80px;
    overflow: auto;
  }

  body {
    padding-left: 1.5em;
    padding-right: 29em;
  }
}

body {
  font: 15px "Helvetica Neue",Helvetica,Arial,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 130%;
  margin: 2.5em auto;
  max-width: 724px;
}

.title, .filename, h1, h2, h3, h4 {
  font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
  font-size-adjust: 0.5;
  font-weight: 500;
  color: #333;
  line-height: 100%;
  margin: 0.8em 0 0.3em;
}
.title { font-size: 36px; }
h1 { font-size: 30px; }
h2 { font-size: 24px; }
h3, h4 { font-size: 18px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

ul.toc li {
  list-style: none;
  text-indent: -2.5em;
  padding-left: 2.5em;
  padding-bottom: 5px;
  margin: 0;
}
ul.toc, ul.toc ul {
  margin: 0 0 0 1.5em;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header {
  width: 100%;
}
table.header td {
  border: none;
  background-color: transparent;
  color: black;
}
.filename {
  color: rgb(119, 119, 119);
  font-size: 23px;
  font-weight: normal;
  height: auto;
  line-height: 100%;
}
#rfc\.abstract+p {
  font-size: 20px;
  font-weight: 300;
  line-height: 130%;
}

samp, tt, code, pre {
  font: 11pt consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure {
  font-style: italic;
  margin: 0 1.5em;
}

address {
  margin: 10px 0 0;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn {
  font-weight: bold;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

ol, ul, li, p {
  padding: 0;
  margin: 0.5em 0 0.5em 2em;
}
li, p {
  margin-left: 0;
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
  /*]]>*/</style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Signaling messages"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Capability and Settings Messages"/>
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Server-Name Setting Option"/>
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Max-Message-Size Capability Indication Option"/>
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Block-wise-Transfer Capability Indication Option"/>
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Using the Capability and Settings message for version negotiation"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Ping and Pong Messages"/>
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Custody Option"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Release Messages"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Abort Messages"/>
<link href="#rfc.section.8" rel="Chapter" title="8 Examples"/>
<link href="#rfc.section.9" rel="Chapter" title="9 Security Considerations"/>
<link href="#rfc.section.10" rel="Chapter" title="10 IANA Considerations"/>
<link href="#rfc.section.10.1" rel="Chapter" title="10.1 Message Codes"/>
<link href="#rfc.section.10.2" rel="Chapter" title="10.2 Signaling Options"/>
<link href="#rfc.references" rel="Chapter" title="11 References"/>
<link href="#rfc.references.1" rel="Chapter" title="11.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="11.2 Informative References"/>
<link href="#rfc.acknowledgements" rel="Chapter"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.1 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Bormann, C., Ed. and K. Hartke" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-bormann-core-coap-sig-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2016-6-27" />
  <meta name="dct.abstract" content="draft-ietf-core-coap-tcp-tls defines how to transport CoAP messages on reliable transports such as TCP, TLS, or WebSockets." />
  <meta name="description" content="draft-ietf-core-coap-tcp-tls defines how to transport CoAP messages on reliable transports such as TCP, TLS, or WebSockets." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">CORE</td>
  <td class="right">C. Bormann, Ed.</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">K. Hartke</td>
</tr>
<tr>
  <td class="left">Intended status: Standards Track</td>
  <td class="right">Universitaet Bremen TZI</td>
</tr>
<tr>
  <td class="left">Expires: December 29, 2016</td>
  <td class="right">June 27, 2016</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">CoAP Signaling Messages<br />
  <span class="filename">draft-bormann-core-coap-sig-latest</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>draft-ietf-core-coap-tcp-tls defines how to transport CoAP messages on reliable transports such as TCP, TLS, or WebSockets.</p>
<p>All these underlying protocols have ways to set up connection properties and manage the connection.  In many cases, these ways cannot be used very well for managing CoAP&#8217;s use of the connection.</p>
<p>Signaling messages are a way to signal information that is about the connection.  They form a third basic kind of messages in CoAP, beyond requests and responses.  Message class 7 is used for signaling messages.</p>
<p>Signaling messages are only relevant for the connection they appear in.  The present draft assumes reliable, sequence-preserving connections.  It is for further study whether signaling messages are needed or useful for DTLS connections.</p>
<p>The present draft, when adopted, would resolve CoRE tickets #400 (message sizes), #388 (by providing a foundation for a mechanism for version negotiation, once that is needed), #390 (connection close reason), #391 (server name indication), #394 (ping/pong).</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on December 29, 2016.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2016 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>2.   <a href="#rfc.section.2">Terminology</a></li>
<li>3.   <a href="#rfc.section.3">Signaling messages</a></li>
<li>4.   <a href="#rfc.section.4">Capability and Settings Messages</a></li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Server-Name Setting Option</a></li>
<li>4.2.   <a href="#rfc.section.4.2">Max-Message-Size Capability Indication Option</a></li>
<li>4.3.   <a href="#rfc.section.4.3">Block-wise-Transfer Capability Indication Option</a></li>
<li>4.4.   <a href="#rfc.section.4.4">Using the Capability and Settings message for version negotiation</a></li>
</ul><li>5.   <a href="#rfc.section.5">Ping and Pong Messages</a></li>
<ul><li>5.1.   <a href="#rfc.section.5.1">Custody Option</a></li>
</ul><li>6.   <a href="#rfc.section.6">Release Messages</a></li>
<li>7.   <a href="#rfc.section.7">Abort Messages</a></li>
<li>8.   <a href="#rfc.section.8">Examples</a></li>
<li>9.   <a href="#rfc.section.9">Security Considerations</a></li>
<li>10.   <a href="#rfc.section.10">IANA Considerations</a></li>
<ul><li>10.1.   <a href="#rfc.section.10.1">Message Codes</a></li>
<li>10.2.   <a href="#rfc.section.10.2">Signaling Options</a></li>
</ul><li>11.   <a href="#rfc.references">References</a></li>
<ul><li>11.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>11.2.   <a href="#rfc.references.2">Informative References</a></li>
</ul><li><a href="#rfc.acknowledgements">Acknowledgements</a></li>
<li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a></h1>
<p id="rfc.section.1.p.1">(Please see abstract for now.)</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#terminology" id="terminology">Terminology</a></h1>
<p id="rfc.section.2.p.1">The key words &#8220;MUST&#8221;, &#8220;MUST NOT&#8221;, &#8220;REQUIRED&#8221;, &#8220;SHALL&#8221;, &#8220;SHALL NOT&#8221;, &#8220;SHOULD&#8221;, &#8220;SHOULD NOT&#8221;, &#8220;RECOMMENDED&#8221;, &#8220;NOT RECOMMENDED&#8221;, &#8220;MAY&#8221;, and &#8220;OPTIONAL&#8221; in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<p id="rfc.section.2.p.2">The definitions of <a href="#RFC7252">[RFC7252]</a> apply.</p>
<p id="rfc.section.2.p.3">In this document, the term &#8220;byte&#8221; is used in its now customary sense as a synonym for &#8220;octet&#8221;.</p>
<p id="rfc.section.2.p.4">Where bit arithmetic is explained, this document uses the notation familiar from the programming language C, except that the operator &#8220;**&#8221; stands for exponentiation.</p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#signaling-messages" id="signaling-messages">Signaling messages</a></h1>
<p id="rfc.section.3.p.1">Signaling messages are structured like any other CoAP message; they have a code, a token, options, and optionally a payload.  (See Section 3 of <a href="#RFC7252">[RFC7252]</a> for the overall structure, as adapted to the specific transport.) The code for a signaling message comes from the 7.xx space.</p>
<p id="rfc.section.3.p.2">Option numbers for signaling messages are specific to the message code, i.e., they do not share the number space with CoAP options for request/response messages or with signaling messages using other codes.</p>
<p id="rfc.section.3.p.3">Signaling options can be elective or critical (see Section 5.4.1 of <a href="#RFC7252">[RFC7252]</a>); if a signaling message option is critical and not understood by the receiver, it MUST abort the connection (see <a href="#sec-abort">Section 7</a>.  (If the option is understood but somehow cannot be carried out, the option defines how to handle the situation.) </p>
<p id="rfc.section.3.p.4">Payloads in signaling messages are diagnostic payloads (see Section 5.5.2 of <a href="#RFC7252">[RFC7252]</a>), unless otherwise determined by a signaling message option.</p>
<p id="rfc.section.3.p.5">This specification lays out five kinds of signaling messages, without necessarily defining an instance of each of the kinds.</p>
<p id="rfc.section.3.p.6">For each message, there is an emitter (that sends the message) and a peer receiving the message.</p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#capability-and-settings-messages" id="capability-and-settings-messages">Capability and Settings Messages</a></h1>
<p id="rfc.section.4.p.1">Capability and Settings messages are used for two purposes:</p>
<p/>

<ul>
  <li>Capability indication options indicate a capability of the emitter to the receiving peer.  Capability options are generally elective options.</li>
  <li>Setting options indicate a setting that will be applied by the emitter.  Setting options are generally critical options.</li>
</ul>
<p id="rfc.section.4.p.3">Both capability indication options and setting options are cumulative, i.e., a capability message without any option is a no-operation (and can be used as such).  (An option that is given might override a previous value for the same option; the option defines how to handle this, if needed.)  Most CSM options are useful mainly as initial messages in the connection.</p>
<p id="rfc.section.4.p.4">Capability and Settings messages carry the code 7.01 (CSM).</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">Code</th>
      <th class="left">Name</th>
      <th class="left">Reference</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">7.01</td>
      <td class="left">CSM</td>
      <td class="left">[RFCthis]</td>
    </tr>
  </tbody>
</table>
<p id="rfc.section.4.p.5">A number of options for Capability and Settings messages are defined in the following subsections.</p>
<h1 id="rfc.section.4.1"><a href="#rfc.section.4.1">4.1.</a> <a href="#server-name-setting-option" id="server-name-setting-option">Server-Name Setting Option</a></h1>
<p id="rfc.section.4.1.p.1">A client can indicate a default value that it wants to set for the Uri-Host options in the messages it sends to the server:</p>
<p id="rfc.section.4.1.p.2">The Server-Name option is defined as follows:</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">Option Number</th>
      <th class="left">Applies to</th>
      <th class="left">Option Name</th>
      <th class="left">Reference</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">1</td>
      <td class="left">CSM</td>
      <td class="left">Server-Name</td>
      <td class="left">[RFCthis]</td>
    </tr>
  </tbody>
</table>
<p id="rfc.section.4.1.p.3">The Server-Name option is a critical option (1 is odd) and carries a &#8220;string&#8221; value, with the same restrictions as for Uri-Host (Section 5.10 of RFC 7252: length is between 1 and 255).</p>
<p id="rfc.section.4.1.p.4">For TLS, the initial value for the Server-Name option is given by the SNI value.  SECURITY CONSIDERATIONS.  For Websockets, the initial value for the Server-Name is given by the HTTP Host header field.</p>
<h1 id="rfc.section.4.2"><a href="#rfc.section.4.2">4.2.</a> <a href="#max-message-size-capability-indication-option" id="max-message-size-capability-indication-option">Max-Message-Size Capability Indication Option</a></h1>
<p id="rfc.section.4.2.p.1">An emitter can indicate a maximum message size that it can comfortably operate on as a recipient.</p>
<p id="rfc.section.4.2.p.2">The Max-Message-Size option is defined as follows:</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">Option Number</th>
      <th class="left">Applies to</th>
      <th class="left">Option Name</th>
      <th class="left">Reference</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">2</td>
      <td class="left">CSM</td>
      <td class="left">Max-Message-Size</td>
      <td class="left">[RFCthis]</td>
    </tr>
  </tbody>
</table>
<p id="rfc.section.4.2.p.3">The Max-Message-Size option is an elective option (2 is even) and carries a &#8220;uint&#8221; value, indicating the message size in bytes.  As per Section 4.6 of <a href="#RFC7252">[RFC7252]</a>, the default value (and the value used when this Option is not implemented) is 1152.  (Note that a peer implementation that relies on this option being indicated and having a certain minimum value will enjoy only limited interoperability.)</p>
<h1 id="rfc.section.4.3"><a href="#rfc.section.4.3">4.3.</a> <a href="#block-wise-transfer-capability-indication-option" id="block-wise-transfer-capability-indication-option">Block-wise-Transfer Capability Indication Option</a></h1>
<p id="rfc.section.4.3.p.1">An emitter can indicate that it supports the block-wise transfer protocol defined in <a href="#I-D.ietf-core-block">[I-D.ietf-core-block]</a>.</p>
<p id="rfc.section.4.3.p.2">The Block-wise-Transfer option is defined as follows:</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">Option Number</th>
      <th class="left">Applies to</th>
      <th class="left">Option Name</th>
      <th class="left">Reference</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">4</td>
      <td class="left">CSM</td>
      <td class="left">Block-wise-Transfer</td>
      <td class="left">[RFCthis]</td>
    </tr>
  </tbody>
</table>
<p id="rfc.section.4.3.p.3">The Block-wise-Transfer option is an elective option (4 is even) and carries an &#8220;empty&#8221; value.  If the option is not given, the peer has no information about whether block-wise transfers are supported by the emitter or not.  An implementation that supports block-wise transfers SHOULD indicate the Block-Wise Transfer option.  If a Max-Message-Size option is being indicated (in the same of a different CSM message) with a value that is greater than 1152, the Block-Wise Transfer option also indicates support for BERT <a href="#I-D.ietf-core-coap-tcp-tls">[I-D.ietf-core-coap-tcp-tls]</a>.</p>
<h1 id="rfc.section.4.4"><a href="#rfc.section.4.4">4.4.</a> <a href="#using-the-capability-and-settings-message-for-version-negotiation" id="using-the-capability-and-settings-message-for-version-negotiation">Using the Capability and Settings message for version negotiation</a></h1>
<p id="rfc.section.4.4.p.1">CoAP is defined in RFC 7252 with a version number of 1.  In contrast to the message layer for UDP and DTLS, the CoAP over TCP message layer does not send the version number in each single message.  Instead, options for the Capability and Settings message can be used to perform a version negotiation.</p>
<p id="rfc.section.4.4.p.2">At the time of writing, there is no known reason for supporting version numbers different from 1.  The details of a version negotiation, once it is actually needed, will depend on the specifics of the new version(s), so the present specification makes no attempt to specify these details.  However, Capability and Settings messages have been specifically designed with a view to supporting such a potential future need.</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#ping-and-pong-messages" id="ping-and-pong-messages">Ping and Pong Messages</a></h1>
<p id="rfc.section.5.p.1">NOTE: The present specification assumes that the CoAP over TCP specification <a href="#I-D.ietf-core-coap-tcp-tls">[I-D.ietf-core-coap-tcp-tls]</a> specifies that empty messages (<a href="#RFC7252">[RFC7252]</a>) can always be sent and will be ignored.  This provides for a basic keep-alive function that can, e.g., refresh NAT bindings.  In contrast, Ping and Pong messages are a bidirectional exchange.</p>
<p id="rfc.section.5.p.2">A Ping message is responded to by a single Pong message with the same token.  As with all signaling messages, the recipient of a Ping or Pong message MUST ignore elective options it does not understand.</p>
<p id="rfc.section.5.p.3">Ping and Pong messages carry the code 7.02 (Ping) and 7.03 (Pong), respectively.</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">Code</th>
      <th class="left">Name</th>
      <th class="left">Reference</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">7.02</td>
      <td class="left">Ping</td>
      <td class="left">[RFCthis]</td>
    </tr>
    <tr>
      <td class="left">7.03</td>
      <td class="left">Pong</td>
      <td class="left">[RFCthis]</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.section.5.1"><a href="#rfc.section.5.1">5.1.</a> <a href="#custody-option" id="custody-option">Custody Option</a></h1>
<p id="rfc.section.5.1.p.1">A peer replying to a Ping message can add a Custody Option to the Pong message it returns.  The Option indicates that the application has processed all request/response messages that it has received in the present connection ahead of the Ping message that prompted the Pong message.  (Note that there is no definition of specific application semantics of &#8220;processed&#8221;, but there is an expectation that the emitter of the Ping leading to the Pong with a Custody Option should be able to free buffers based on this indication.)</p>
<p id="rfc.section.5.1.p.2">A Custody Option can also be sent in a Ping message to explicitly request the return of a Custody Option in the Pong message.  A peer is, however, always free to indicate that it has finished processing all previous request/response messages by sending a Custody Option (which is therefore elective) in a Pong message.  A peer is also free NOT to send a Custody Option in case it is still processing previous request/response messages, however, it SHOULD delay its response to a Ping with a Custody Option until it also can return one.</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">Option Number</th>
      <th class="left">Applies to</th>
      <th class="left">Option Name</th>
      <th class="left">Reference</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">2</td>
      <td class="left">Ping, Pong</td>
      <td class="left">Custody</td>
      <td class="left">[RFCthis]</td>
    </tr>
  </tbody>
</table>
<p id="rfc.section.5.1.p.3">The Custody option is an elective option (2 is even) and carries an &#8220;empty&#8221; value.</p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#release-messages" id="release-messages">Release Messages</a></h1>
<p id="rfc.section.6.p.1">A release message indicates that the emitter does not want to continue maintaining the connection and opts for an orderly shutdown; the details are in the options.  A diagnostic payload MAY be included.  A release message will normally be replied to by the peer by closing the TCP/TLS connection.  Messages may be in flight when the emitter decides to send a Release message; the general expectation is that these will still be processed.</p>
<p id="rfc.section.6.p.2">Release messages carry the code 7.04 (Release).</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">Code</th>
      <th class="left">Name</th>
      <th class="left">Reference</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">7.04</td>
      <td class="left">Release</td>
      <td class="left">[RFCthis]</td>
    </tr>
  </tbody>
</table>
<p id="rfc.section.6.p.3">Release messages can indicate one or more reasons using elective options; the following options are defined:</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">Option Number</th>
      <th class="left">Applies to</th>
      <th class="left">Option Name</th>
      <th class="left">Reference</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">2</td>
      <td class="left">Release</td>
      <td class="left">Bad-Server-Name</td>
      <td class="left">[RFCthis]</td>
    </tr>
    <tr>
      <td class="left">4</td>
      <td class="left">Release</td>
      <td class="left">Alternative-Address</td>
      <td class="left">[RFCthis]</td>
    </tr>
    <tr>
      <td class="left">6</td>
      <td class="left">Release</td>
      <td class="left">Hold-Off</td>
      <td class="left">[RFCthis]</td>
    </tr>
  </tbody>
</table>
<p id="rfc.section.6.p.4">The Bad-Server-Name option indicates that the default as set by the CSM option Server-Name is unlikely to be useful for this server.  The value is empty.  (2 is even, i.e., the option is elective.)</p>
<p id="rfc.section.6.p.5">The Alternative-Address option requests the peer to instead open a connection of the same kind as the present connection to the alternative transport address given.  The value is a string, of the form &#8220;authority&#8221; defined in Section 3.2 of RFC 3986.  (4 is even, i.e., the option is elective.)  SECURITY CONSIDERATIONS.</p>
<p id="rfc.section.6.p.6">The Hold-Off option indicates that the server is requesting that the peer not reconnect to it for the number of seconds given as the value.  The value is a uint.  (6 is even, i.e., the option is elective.)</p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#sec-abort" id="sec-abort">Abort Messages</a></h1>
<p id="rfc.section.7.p.1">An abort message indicates that the emitter is unable to continue maintaining the connection and cannot even wait for an orderly release; the emitter shuts down the connection immediately after the abort (and may or may not wait for a release or abort message or connection shutdown in the inverse direction).  A diagnostic payload SHOULD be included in the Abort message.  Messages may be in flight when the emitter decides to send an abort message; the general expectation is that these will NOT be processed.</p>
<p id="rfc.section.7.p.2">Abort messages carry the code 7.05 (Abort).</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">Code</th>
      <th class="left">Name</th>
      <th class="left">Reference</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">7.05</td>
      <td class="left">Abort</td>
      <td class="left">[RFCthis]</td>
    </tr>
  </tbody>
</table>
<p id="rfc.section.7.p.3">Abort messages can indicate one or more reasons using elective options; the following options are defined:</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">Option Number</th>
      <th class="left">Applies to</th>
      <th class="left">Option Name</th>
      <th class="left">Reference</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">2</td>
      <td class="left">Abort</td>
      <td class="left">Bad-CSM-Option</td>
      <td class="left">[RFCthis]</td>
    </tr>
  </tbody>
</table>
<p id="rfc.section.7.p.4">The Bad-CSM-Option indicates that the emitter is unable to process the CSM option identified by its option number, e.g. when it is critical and the option number is unknown by the emitter, or when there is parameter problem with the value of an elective option.  The value is a uint.  (2 is even, i.e., the option is elective.)  (More detailed information SHOULD be given as a diagnostic payload.)</p>
<p id="rfc.section.7.p.5">One reason for an emitter to generate an abort message is a general syntax error in the byte stream received; no specific option has been defined for this, as the details of that syntax error are best left to a diagnostic payload.</p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> <a href="#examples" id="examples">Examples</a></h1>
<p id="rfc.section.8.p.1">An encoded example of a Ping message with a non-empty token is shown in <a href="#fig-ping-example">Figure 1</a>.</p>
<div id="rfc.figure.1"/>
<div id="fig-ping-example"/>
<pre>
    0                   1                   2
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      0x01     |      0xe2     |      0x42     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

    Len   =    0 -------&gt; 0x01
    TKL   =    1 ___/
    Code  = 7.02 Ping --&gt; 0xe2
    Token =               0x42
</pre>
<p class="figure">Figure 1: Ping Message Example</p>
<p id="rfc.section.8.p.2">An encoded example of the corresponding Pong message is shown in <a href="#fig-pong-example">Figure 2</a>.</p>
<div id="rfc.figure.2"/>
<div id="fig-pong-example"/>
<pre>
    0                   1                   2
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      0x01     |      0xe3     |      0x42     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

    Len   =    0 -------&gt; 0x01
    TKL   =    1 ___/
    Code  = 7.03 Pong --&gt; 0xe3
    Token =               0x42
</pre>
<p class="figure">Figure 2: Pong Message Example</p>
<h1 id="rfc.section.9"><a href="#rfc.section.9">9.</a> <a href="#security" id="security">Security Considerations</a></h1>
<p id="rfc.section.9.p.1">The security considerations of <a href="#RFC7252">[RFC7252]</a> apply.</p>
<p/>

<ul>
  <li>The guidance given by an Alternative-Address option cannot be followed blindly.  In particular, a peer MUST NOT assume that a successful connection to the Alternative-Address inherits all the security properties of the current connection.</li>
  <li>SNI vs. Server-Name: Any security negotiated in the TLS handshake is for the SNI name exchanged in the TLS handshake and checked against the certificate provided by the server.  The Server-Name option cannot be used to extend these security properties to the additional server name.</li>
</ul>
<h1 id="rfc.section.10"><a href="#rfc.section.10">10.</a> <a href="#iana" id="iana">IANA Considerations</a></h1>
<h1 id="rfc.section.10.1"><a href="#rfc.section.10.1">10.1.</a> <a href="#message-codes" id="message-codes">Message Codes</a></h1>
<p id="rfc.section.10.1.p.1">IANA is requested to create a third sub-registry for values of the Code field in the CoAP header (cf. Section 12.1 of <a href="#RFC7252">[RFC7252]</a>).</p>
<p id="rfc.section.10.1.p.2">The IANA policy for future additions to this sub-registry is &#8220;IETF Review or IESG Approval&#8221; as described in <a href="#RFC5226">[RFC5226]</a>.</p>
<p id="rfc.section.10.1.p.3">(Editor note to be removed: remember to copy down values from above)</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">Code</th>
      <th class="left">Name</th>
      <th class="left">Reference</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">7.01</td>
      <td class="left">CSM</td>
      <td class="left">[RFCthis]</td>
    </tr>
    <tr>
      <td class="left">7.02</td>
      <td class="left">Ping</td>
      <td class="left">[RFCthis]</td>
    </tr>
    <tr>
      <td class="left">7.03</td>
      <td class="left">Pong</td>
      <td class="left">[RFCthis]</td>
    </tr>
    <tr>
      <td class="left">7.04</td>
      <td class="left">Release</td>
      <td class="left">[RFCthis]</td>
    </tr>
    <tr>
      <td class="left">7.05</td>
      <td class="left">Abort</td>
      <td class="left">[RFCthis]</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.section.10.2"><a href="#rfc.section.10.2">10.2.</a> <a href="#signaling-options" id="signaling-options">Signaling Options</a></h1>
<p id="rfc.section.10.2.p.1">IANA is requested to create a sub-registry for signaling options similar to the CoAP Option Numbers Registry (Section 12.2 of <a href="#RFC7252">[RFC7252]</a>), with the single change that a fourth column is added to the sub-registry that is one of the message codes in the message code subregistry (<a href="#message-codes">Section 10.1</a>).</p>
<p id="rfc.section.10.2.p.2">The IANA policy for future additions to this sub-registry is based on number ranges for the option numbers, analogous to the policy defined in Section 12.2 of <a href="#RFC7252">[RFC7252]</a>.</p>
<p id="rfc.section.10.2.p.3">(Editor note to be removed: remember to copy down values from above)</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <thead>
    <tr>
      <th class="left">Option Number</th>
      <th class="left">Applies to</th>
      <th class="left">Option Name</th>
      <th class="left">Reference</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="left">1</td>
      <td class="left">CSM</td>
      <td class="left">Server-Name</td>
      <td class="left">[RFCthis]</td>
    </tr>
    <tr>
      <td class="left">2</td>
      <td class="left">CSM</td>
      <td class="left">Max-Message-Size</td>
      <td class="left">[RFCthis]</td>
    </tr>
    <tr>
      <td class="left">4</td>
      <td class="left">CSM</td>
      <td class="left">Block-wise-Transfer</td>
      <td class="left">[RFCthis]</td>
    </tr>
    <tr>
      <td class="left">2</td>
      <td class="left">Ping, Pong</td>
      <td class="left">Custody</td>
      <td class="left">[RFCthis]</td>
    </tr>
    <tr>
      <td class="left">2</td>
      <td class="left">Release</td>
      <td class="left">Bad-Server-Name</td>
      <td class="left">[RFCthis]</td>
    </tr>
    <tr>
      <td class="left">4</td>
      <td class="left">Release</td>
      <td class="left">Alternative-Address</td>
      <td class="left">[RFCthis]</td>
    </tr>
    <tr>
      <td class="left">6</td>
      <td class="left">Release</td>
      <td class="left">Hold-Off</td>
      <td class="left">[RFCthis]</td>
    </tr>
    <tr>
      <td class="left">2</td>
      <td class="left">Abort</td>
      <td class="left">Bad-CSM-Option</td>
      <td class="left">[RFCthis]</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references"><a href="#rfc.references">11.</a> References</h1>
<h1 id="rfc.references.1"><a href="#rfc.references.1">11.1.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a>Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5226">[RFC5226]</b>
      </td>
      <td class="top"><a>Narten, T.</a> and <a>H. Alvestrand</a>, "<a href="http://tools.ietf.org/html/rfc5226">Guidelines for Writing an IANA Considerations Section in RFCs</a>", BCP 26, RFC 5226, DOI 10.17487/RFC5226, May 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7252">[RFC7252]</b>
      </td>
      <td class="top"><a>Shelby, Z.</a>, <a>Hartke, K.</a> and <a>C. Bormann</a>, "<a href="http://tools.ietf.org/html/rfc7252">The Constrained Application Protocol (CoAP)</a>", RFC 7252, DOI 10.17487/RFC7252, June 2014.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references.2"><a href="#rfc.references.2">11.2.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-core-block">[I-D.ietf-core-block]</b>
      </td>
      <td class="top"><a>Bormann, C.</a> and <a>Z. Shelby</a>, "<a href="http://tools.ietf.org/html/draft-ietf-core-block-20">Block-wise transfers in CoAP</a>", Internet-Draft draft-ietf-core-block-20, April 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-core-coap-tcp-tls">[I-D.ietf-core-coap-tcp-tls]</b>
      </td>
      <td class="top"><a>Bormann, C.</a>, <a>Lemay, S.</a>, <a>Technologies, Z.</a> and <a>H. Tschofenig</a>, "<a href="http://tools.ietf.org/html/draft-ietf-core-coap-tcp-tls-02">A TCP and TLS Transport for the Constrained Application Protocol (CoAP)</a>", Internet-Draft draft-ietf-core-coap-tcp-tls-02, April 2016.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.acknowledgements">
  <a href="#rfc.acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.A.p.1">Significant parts of the present text have been contributed by Hannes Tschofenig.  Matthias Kovatsch contributed significantly to this draft.</p>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Carsten Bormann</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Bormann</span>
	  </span>
	</span>
	<span class="org vcardline">Universitaet Bremen TZI</span>
	<span class="adr">
	  <span class="vcardline">Postfach 330440</span>

	  <span class="vcardline">
		<span class="locality">Bremen</span>,  
		<span class="region"></span>
		<span class="code">D-28359</span>
	  </span>
	  <span class="country-name vcardline">Germany</span>
	</span>
	<span class="vcardline">Phone: +49-421-218-63921</span>

<span class="vcardline">EMail: <a href="mailto:cabo@tzi.org">cabo@tzi.org</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Klaus Hartke</span> 
	  <span class="n hidden">
		<span class="family-name">Hartke</span>
	  </span>
	</span>
	<span class="org vcardline">Universitaet Bremen TZI</span>
	<span class="adr">
	  <span class="vcardline">Postfach 330440</span>

	  <span class="vcardline">
		<span class="locality">Bremen</span>,  
		<span class="region"></span>
		<span class="code">D-28359</span>
	  </span>
	  <span class="country-name vcardline">Germany</span>
	</span>
	<span class="vcardline">Phone: +49-421-218-63905</span>

<span class="vcardline">EMail: <a href="mailto:hartke@tzi.org">hartke@tzi.org</a></span>

  </address>
</div>

  <div class="github-fork-ribbon-wrapper"><div class="github-fork-ribbon"><a href="https://github.com/core-wg/coap-sig">Fork me on GitHub</a></div></div>
</body>
</html>
